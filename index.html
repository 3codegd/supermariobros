<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NES Mario Level Editor</title>
<style>
    body {
        background: #1a1a1a;
        color: white;
        font-family: monospace;
        display: flex;
        gap: 20px;
        padding: 20px;
    }

    #palette {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .tilePreview {
        width: 48px;
        height: 48px;
        image-rendering: pixelated;
        border: 2px solid white;
        cursor: pointer;
    }

    #editorCanvas {
        image-rendering: pixelated;
        border: 4px solid white;
        background: #5c94fc; /* NES sky blue */
        cursor: crosshair;
    }
</style>
</head>
<body>

<!----------------------- TILE PALETTE ------------------------>
<div id="palette">
    <div id="ground" class="tilePreview"></div>
    <div id="question" class="tilePreview"></div>
    <div id="brick" class="tilePreview"></div>
</div>

<!----------------------- MAIN EDITOR ------------------------>
<canvas id="editorCanvas" width="512" height="240"></canvas>

<script>
/* ============================================================
   NES COLOR PALETTE (official)
   ============================================================ */
const NES = {
    black: "#000000",
    brown: "#A04800",
    brick_brown: "#B85800",
    question_orange: "#F8B800",
    question_dark: "#A06000",
    ground_brown: "#885000",
    ground_shadow: "#503000",
    outline: "#000000"
};

/* ============================================================
   CREATE 8×8 TILE PIXEL DATA
   ============================================================ */

// --- Ground tile (SMB1 overworld) ---
function drawGroundTile(ctx) {
    ctx.fillStyle = NES.ground_brown;
    ctx.fillRect(0, 0, 8, 8);

    ctx.fillStyle = NES.outline;
    ctx.fillRect(0, 7, 8, 1);      // bottom line

    ctx.fillStyle = NES.ground_shadow;
    ctx.fillRect(0, 4, 8, 1);      // middle shadow
}


// --- Question Block ---
function drawQuestionTile(ctx) {
    ctx.fillStyle = NES.question_orange;
    ctx.fillRect(0, 0, 8, 8);

    // border
    ctx.fillStyle = NES.outline;
    ctx.fillRect(0, 0, 8, 1);
    ctx.fillRect(0, 7, 8, 1);
    ctx.fillRect(0, 0, 1, 8);
    ctx.fillRect(7, 0, 1, 8);

    // question mark shape
    ctx.fillRect(3, 2, 2, 1);
    ctx.fillRect(4, 3, 1, 1);
    ctx.fillRect(3, 4, 2, 1);
    ctx.fillRect(3, 5, 1, 1); // stem
    ctx.fillRect(3, 6, 1, 1); // dot
}


// --- Brick Block ---
function drawBrickTile(ctx) {
    ctx.fillStyle = NES.brick_brown;
    ctx.fillRect(0, 0, 8, 8);

    ctx.fillStyle = NES.outline;
    ctx.fillRect(0, 0, 8, 1);    // top
    ctx.fillRect(0, 3, 8, 1);    // middle line

    // brick cracks
    ctx.fillRect(2, 1, 1, 2);
    ctx.fillRect(5, 1, 1, 2);
    ctx.fillRect(1, 4, 1, 3);
    ctx.fillRect(4, 4, 1, 3);
    ctx.fillRect(6, 4, 1, 3);
}

/* ============================================================
   CREATE TILE CANVASES (SCALED ×6 TO LOOK NICE)
   ============================================================ */

function makeTile(drawFunc) {
    let c = document.createElement("canvas");
    c.width = 8;
    c.height = 8;
    let ctx = c.getContext("2d");

    drawFunc(ctx);

    return c;
}

const Tiles = {
    ground: makeTile(drawGroundTile),
    question: makeTile(drawQuestionTile),
    brick: makeTile(drawBrickTile)
};

/* ============================================================
   DRAW PALETTE
   ============================================================ */

function placeTilePreview(id, tile) {
    let target = document.getElementById(id);
    target.style.backgroundImage =
        `url(${tile.toDataURL()})`;
    target.style.backgroundSize = "48px 48px";
}

placeTilePreview("ground", Tiles.ground);
placeTilePreview("question", Tiles.question);
placeTilePreview("brick", Tiles.brick);

/* ============================================================
   CANVAS EDITOR
   ============================================================ */

const SCALE = 3;           // 8px tiles → 24px
const TILE_SIZE = 8 * SCALE;

const canvas = document.getElementById("editorCanvas");
const ctx = canvas.getContext("2d");

const cols = canvas.width / TILE_SIZE;
const rows = canvas.height / TILE_SIZE;

let selected = "ground";

// click palette to select tile
document.querySelectorAll(".tilePreview").forEach(p => {
    p.onclick = () => {
        selected = p.id;
    };
});

// tile map
const map = [];
for (let y = 0; y < rows; y++) {
    map[y] = [];
    for (let x = 0; x < cols; x++) map[y][x] = null;
}

canvas.addEventListener("mousedown", drawTile);
canvas.addEventListener("mousemove", e => {
    if (e.buttons === 1) drawTile(e);
});

function drawTile(e) {
    let rect = canvas.getBoundingClientRect();
    let x = Math.floor((e.clientX - rect.left) / TILE_SIZE);
    let y = Math.floor((e.clientY - rect.top) / TILE_SIZE);

    if (x < 0 || y < 0 || x >= cols || y >= rows) return;

    map[y][x] = selected;

    ctx.imageSmoothingEnabled = false;
    ctx.drawImage(
        Tiles[selected],
        0, 0, 8, 8,
        x * TILE_SIZE,
        y * TILE_SIZE,
        TILE_SIZE,
        TILE_SIZE
    );
}

</script>
</body>
</html>
